<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zingify - Web Nghe Nhạc</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* CSS cho thanh trượt mượt mà trên mobile */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 14px; /* To hơn xíu cho dễ bấm trên đt */
            width: 14px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            margin-top: -5px;
            box-shadow: 0 0 4px rgba(0,0,0,0.5);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #52525b;
            border-radius: 2px;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Hiệu ứng đĩa quay khi phát nhạc */
        .spinning {
            animation: spin 10s linear infinite;
        }
        @keyframes spin { 100% { -webkit-transform: rotate(360deg); transform:rotate(360deg); } }
    </style>
</head>
<body class="bg-black text-white font-sans h-screen flex flex-col overflow-hidden select-none">

    <!-- Sửa lỗi iOS: Thêm preload, playsinline -->
    <audio id="audio-player" preload="auto" playsinline webkit-playsinline></audio>

    <div class="flex flex-1 overflow-hidden">
        
        <!-- Sidebar -->
        <aside id="sidebar" class="fixed inset-y-0 left-0 z-50 w-64 bg-black transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-300 border-r border-zinc-800 flex flex-col">
            <div class="p-6 flex-1">
                <div class="flex items-center gap-2 mb-8 text-emerald-500 font-bold text-2xl">
                    <i data-lucide="monitor-speaker" class="w-8 h-8"></i>
                    <span>Zingify</span>
                </div>
                
                <nav class="space-y-4">
                    <div onclick="showHome()" class="flex items-center gap-4 px-4 py-3 rounded-md cursor-pointer bg-zinc-800 text-white font-medium hover:bg-zinc-700 transition">
                        <i data-lucide="home"></i> <span>Trang chủ</span>
                    </div>
                    <div class="flex items-center gap-4 px-4 py-3 rounded-md cursor-pointer text-zinc-400 hover:text-white hover:bg-zinc-900 transition font-medium">
                        <i data-lucide="search"></i> <span>Tìm kiếm</span>
                    </div>
                    <div class="flex items-center gap-4 px-4 py-3 rounded-md cursor-pointer text-zinc-400 hover:text-white hover:bg-zinc-900 transition font-medium">
                        <i data-lucide="library"></i> <span>Thư viện</span>
                    </div>
                    <div onclick="openAdminModal()" class="flex items-center gap-4 px-4 py-3 rounded-md cursor-pointer text-red-400 hover:text-red-300 hover:bg-zinc-900 transition font-medium border border-zinc-800 mt-4">
                        <i data-lucide="shield-alert"></i> <span>Admin / Quản lý</span>
                    </div>
                </nav>
            </div>
            
            <button id="close-sidebar" class="absolute top-4 right-4 md:hidden text-zinc-400 p-2">
                <i data-lucide="x"></i>
            </button>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 bg-gradient-to-b from-zinc-800 to-black overflow-y-auto no-scrollbar relative">
            <header class="md:hidden flex items-center justify-between p-4 sticky top-0 bg-black/80 backdrop-blur-md z-40">
                <button id="open-sidebar" class="p-2">
                    <i data-lucide="menu"></i>
                </button>
                <span class="font-bold">Zingify</span>
                <div class="w-6"></div>
            </header>

            <div class="p-6 md:p-8 pb-40"> <!-- Tăng padding bottom để không bị che bởi player -->
                <!-- Hero Section -->
                <div class="flex flex-col md:flex-row gap-6 items-center md:items-end mb-8 transition-all duration-300 text-center md:text-left" id="hero-section">
                    <div class="relative group">
                         <img id="hero-img" src="" alt="Album Art" class="w-48 h-48 md:w-60 md:h-60 shadow-2xl shadow-black rounded-full md:rounded-md object-cover bg-zinc-800 border-2 border-zinc-700">
                    </div>
                   
                    <div class="flex flex-col gap-2 items-center md:items-start">
                        <span class="text-xs font-bold uppercase tracking-wider text-emerald-500">Đang phát</span>
                        <h1 id="hero-title" class="text-2xl md:text-5xl font-black mb-2 leading-tight line-clamp-2">...</h1>
                        <div class="flex items-center text-zinc-300 text-sm font-medium flex-wrap justify-center md:justify-start">
                            <span id="hero-artist" class="text-white hover:underline cursor-pointer">...</span>
                            <span class="mx-2 hidden md:inline">•</span>
                            <span id="hero-duration" class="hidden md:inline">0:00</span>
                        </div>
                    </div>
                </div>

                <!-- Action Bar -->
                <div class="flex items-center justify-center md:justify-start gap-6 mb-8">
                    <button id="hero-play-btn" class="w-14 h-14 bg-emerald-500 rounded-full flex items-center justify-center hover:scale-105 active:scale-95 hover:bg-emerald-400 transition shadow-lg text-black">
                        <i data-lucide="play" class="fill-black ml-1"></i>
                    </button>
                </div>

                <!-- Song List -->
                <div>
                    <h2 class="text-xl md:text-2xl font-bold mb-4">Gợi ý cho bạn</h2>
                    <div id="song-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                        <!-- JS renders here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ADMIN MODAL -->
    <div id="admin-modal" class="fixed inset-0 z-[60] bg-black/90 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-zinc-900 w-full max-w-3xl rounded-xl shadow-2xl border border-zinc-700 max-h-[85vh] overflow-y-auto flex flex-col">
            <div class="flex items-center justify-between p-4 md:p-6 border-b border-zinc-800 sticky top-0 bg-zinc-900 z-10">
                <h2 class="text-xl font-bold text-white flex items-center gap-2">
                    <i data-lucide="settings" class="text-emerald-500"></i> Quản Lý
                </h2>
                <button onclick="closeAdminModal()" class="text-zinc-400 hover:text-white p-2">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <div class="p-4 md:p-6 space-y-6">
                <!-- CẢNH BÁO LOCAL STORAGE -->
                <div class="bg-blue-900/20 border border-blue-600/30 p-4 rounded-lg flex items-start gap-3">
                    <i data-lucide="info" class="text-blue-500 flex-shrink-0 mt-1 w-5 h-5"></i>
                    <div class="text-xs md:text-sm text-blue-200">
                        <strong>Lưu ý GitHub:</strong><br>
                        Sửa code phần <code>defaultSongs</code> để cập nhật nhạc cho tất cả mọi người. Nhập ở đây chỉ lưu trên máy bạn.
                    </div>
                </div>

                <!-- Form Thêm -->
                <div class="bg-zinc-800/30 p-4 rounded-lg border border-zinc-700/50">
                    <h3 class="text-base font-semibold mb-3 text-emerald-400">Thêm Bài Hát Mới</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <input type="text" id="input-title" class="bg-zinc-900 border border-zinc-700 rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-emerald-500" placeholder="Tên bài hát...">
                        <input type="text" id="input-artist" class="bg-zinc-900 border border-zinc-700 rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-emerald-500" placeholder="Ca sĩ...">
                        <input type="text" id="input-cover" class="bg-zinc-900 border border-zinc-700 rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-emerald-500" placeholder="Link ảnh...">
                        <input type="text" id="input-url" class="bg-zinc-900 border border-zinc-700 rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-emerald-500" placeholder="Link MP3...">
                    </div>
                    <div class="flex gap-2 mt-4">
                        <button onclick="addNewSong()" class="flex-1 bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-2 px-4 rounded transition flex items-center justify-center gap-2 text-sm">
                            <i data-lucide="plus" class="w-4 h-4"></i> Thêm
                        </button>
                        <button onclick="resetDefaultSongs()" class="px-4 bg-zinc-700 hover:bg-zinc-600 text-zinc-300 font-medium rounded transition text-sm border border-zinc-600" title="Khôi phục gốc">
                            <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>

                <!-- Danh sách Admin -->
                <div>
                    <h3 class="text-lg font-semibold text-white mb-3">Danh Sách</h3>
                    <div class="bg-zinc-800 rounded-lg overflow-hidden border border-zinc-700">
                        <div class="max-h-60 overflow-y-auto">
                            <table class="w-full text-left text-sm text-zinc-400">
                                <thead class="bg-zinc-900 text-xs uppercase font-medium text-zinc-500 sticky top-0">
                                    <tr>
                                        <th class="px-4 py-3">Bài Hát</th>
                                        <th class="px-2 py-3 text-center w-14">Ẩn</th>
                                        <th class="px-2 py-3 text-center w-14">Xóa</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-song-list" class="divide-y divide-zinc-700">
                                    <!-- Render by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Player Bar -->
    <div class="fixed bottom-0 left-0 right-0 h-24 bg-zinc-900/95 backdrop-blur-lg border-t border-zinc-800 px-4 grid grid-cols-[1fr_auto_1fr] md:grid-cols-3 items-center z-50 pb-safe">
        <!-- Left: Info -->
        <div class="flex items-center gap-3 overflow-hidden pr-2">
            <img id="mini-cover" src="" class="w-12 h-12 rounded object-cover hidden sm:block shadow-lg bg-zinc-800 border border-zinc-700">
            <div class="flex flex-col justify-center overflow-hidden">
                <div class="flex items-center gap-2">
                    <h4 id="mini-title" class="text-sm font-semibold text-white truncate max-w-[120px] md:max-w-[180px]">...</h4>
                </div>
                <span id="mini-artist" class="text-xs text-zinc-400 truncate">...</span>
            </div>
        </div>

        <!-- Center: Controls -->
        <div class="flex flex-col items-center w-full max-w-[400px]">
            <div class="flex items-center gap-6 mb-1">
                <button id="prev-btn" class="text-zinc-400 hover:text-white transition p-2"><i data-lucide="skip-back" class="w-5 h-5 fill-current"></i></button>
                
                <button id="play-pause-btn" class="bg-white rounded-full p-2 text-black hover:scale-105 active:scale-95 transition w-9 h-9 flex items-center justify-center">
                    <i data-lucide="play" class="w-4 h-4 fill-black ml-0.5"></i>
                </button>
                
                <button id="next-btn" class="text-zinc-400 hover:text-white transition p-2"><i data-lucide="skip-forward" class="w-5 h-5 fill-current"></i></button>
            </div>
            
            <div class="flex items-center gap-2 w-full px-2">
                <span id="current-time" class="text-[10px] text-zinc-400 w-8 text-right font-mono">0:00</span>
                <div class="relative flex-1 h-4 flex items-center group">
                    <input id="progress-bar" type="range" min="0" max="100" value="0" class="absolute z-10 w-full h-1 opacity-0 cursor-pointer group-hover:opacity-100 h-full">
                    <div class="w-full h-1 bg-zinc-600 rounded-full overflow-hidden">
                        <div id="progress-fill" class="h-full bg-white w-0 rounded-full"></div>
                    </div>
                </div>
                <span id="total-duration" class="text-[10px] text-zinc-400 w-8 font-mono">0:00</span>
            </div>
        </div>

        <!-- Right: Volume (Hidden on small mobile) -->
        <div class="hidden md:flex items-center justify-end gap-2">
            <button id="mute-btn" class="text-zinc-400 hover:text-white"><i data-lucide="volume-2" class="w-4 h-4"></i></button>
            <div class="w-24 h-1 bg-zinc-600 rounded-full relative">
                 <input id="volume-bar" type="range" min="0" max="1" step="0.01" value="1" class="absolute w-full h-full opacity-0 cursor-pointer z-10">
                 <div id="volume-fill" class="h-full bg-white w-[80%] rounded-full absolute top-0 left-0 pointer-events-none"></div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. DỮ LIỆU ---
        
        // Link nhạc ví dụ (Cần đảm bảo link MP3 direct, không qua redirect để chạy mượt trên iOS)
        const defaultSongs = [
            {
                id: 1,
                title: "Christmas",
                artist: "DoThy",
                cover: "https://i.imgur.com/tWzvF8A.jpeg",
                url: "https://github.com/iamsonnk4/upanhvn/releases/download/1/Louisvuiton.Christmas.mp3",
                isHidden: false
            },
            {
                id: 2,
                title: "Nhạc Demo 2",
                artist: "SoundHelix",
                cover: "https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=300&h=300&fit=crop",
                url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3",
                isHidden: false
            }
        ];

        const STORAGE_KEY = 'zingify_songs_github_v2_ios'; 
        let allSongs = [];
        let playlist = []; 
        let currentIndex = 0;
        let isPlaying = false;
        let isSeeking = false; // Tránh xung đột khi kéo thanh trượt

        // DOM Elements
        const audio = document.getElementById('audio-player');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const heroPlayBtn = document.getElementById('hero-play-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressFill = document.getElementById('progress-fill');
        const currentTimeEl = document.getElementById('current-time');
        const totalDurationEl = document.getElementById('total-duration');
        const volumeBar = document.getElementById('volume-bar');
        const volumeFill = document.getElementById('volume-fill');
        const heroImg = document.getElementById('hero-img');

        // --- 2. HỆ THỐNG (INIT) ---

        function init() {
            loadData();
            updatePlaylist();
            
            // Xử lý Audio Context cho iOS (Hack để mở khóa âm thanh ngay lần chạm đầu)
            document.addEventListener('touchstart', unlockAudio, { once: true });
            document.addEventListener('click', unlockAudio, { once: true });

            if (playlist.length > 0) {
                // Chỉ load thông tin bài hát lên UI, KHÔNG gọi audio.load() ngay lập tức để tránh lỗi
                renderCurrentSongInfo(0);
            } else {
                showEmptyState();
            }
            
            if(window.lucide) lucide.createIcons();
        }

        function unlockAudio() {
            // Tạo một buffer rỗng và phát nó để trình duyệt cho phép phát nhạc sau này
            // Đây là kỹ thuật chuẩn cho Web Audio API trên iOS
            audio.load();
        }

        function loadData() {
            try {
                const data = localStorage.getItem(STORAGE_KEY);
                allSongs = data ? JSON.parse(data) : [...defaultSongs];
            } catch (e) {
                console.log(e);
                allSongs = [...defaultSongs];
            }
        }

        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(allSongs));
        }

        function updatePlaylist() {
            playlist = allSongs.filter(song => !song.isHidden);
            if (currentIndex >= playlist.length) currentIndex = 0;
            renderSongList();
        }

        // --- 3. CORE AUDIO LOGIC (QUAN TRỌNG CHO IOS) ---

        // Hàm này chỉ cập nhật giao diện, KHÔNG đụng vào thẻ Audio
        function renderCurrentSongInfo(index) {
            if(playlist.length === 0) return;
            const song = playlist[index];

            heroImg.src = song.cover || "https://via.placeholder.com/300";
            document.getElementById('mini-cover').src = song.cover || "https://via.placeholder.com/100";
            document.getElementById('hero-title').innerText = song.title;
            document.getElementById('mini-title').innerText = song.title;
            document.getElementById('hero-artist').innerText = song.artist;
            document.getElementById('mini-artist').innerText = song.artist;
            
            // Reset thanh thời gian tạm thời
            progressBar.value = 0;
            progressFill.style.width = '0%';
            currentTimeEl.innerText = "0:00";
            totalDurationEl.innerText = "Loading...";
            
            // Highlight list
            renderSongList();
        }

        // Hàm này thực sự tải nhạc và phát
        async function loadAndPlaySong(index) {
            if (playlist.length === 0) return;
            
            currentIndex = index;
            const song = playlist[index];
            
            renderCurrentSongInfo(index);

            // QUAN TRỌNG: Gán src và gọi load()
            audio.src = song.url;
            audio.load(); // Bắt buộc trên iOS sau khi đổi src

            try {
                // Thử phát nhạc
                await audio.play();
                isPlaying = true;
                updatePlayIcons('pause');
                heroImg.classList.add('spinning');
            } catch (error) {
                console.error("Lỗi phát nhạc (Thường do Autoplay Policy):", error);
                isPlaying = false;
                updatePlayIcons('play');
                heroImg.classList.remove('spinning');
                // Nếu lỗi, có thể do chưa tương tác người dùng, chờ lần bấm sau
            }
        }

        function togglePlay() {
            if(playlist.length === 0) return;

            // Nếu chưa có src (lần đầu vào web), load bài đầu tiên
            if (!audio.src || audio.src === window.location.href) {
                loadAndPlaySong(currentIndex);
                return;
            }

            if (audio.paused) {
                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        isPlaying = true;
                        updatePlayIcons('pause');
                        heroImg.classList.add('spinning');
                    }).catch(error => {
                        console.error("Play prevented:", error);
                        // Cố gắng load lại và phát nếu bị lỗi
                        audio.load(); 
                        // Không gọi play ngay để tránh loop
                    });
                }
            } else {
                audio.pause();
                isPlaying = false;
                updatePlayIcons('play');
                heroImg.classList.remove('spinning');
            }
        }

        function updatePlayIcons(state) {
            const icon = state === 'pause' ? 'pause' : 'play';
            // Icon nhỏ ở thanh dưới
            playPauseBtn.innerHTML = `<i data-lucide="${icon}" class="w-4 h-4 fill-black ml-${state==='play'?0.5:0}"></i>`;
            // Icon to ở banner
            heroPlayBtn.innerHTML = `<i data-lucide="${icon}" class="fill-black ml-${state==='play'?1:0}"></i>`;
            
            if(window.lucide) lucide.createIcons();
        }

        // --- 4. EVENTS HANDLE ---

        audio.addEventListener('loadedmetadata', () => {
             const duration = audio.duration;
             if(duration && !isNaN(duration)) {
                 totalDurationEl.innerText = formatTime(duration);
             }
        });

        // Event này chạy liên tục khi nhạc đang phát
        audio.addEventListener('timeupdate', () => {
            if (isSeeking) return; // Nếu đang kéo tua thì không cập nhật tự động
            
            if (audio.duration) {
                const pct = (audio.currentTime / audio.duration) * 100;
                progressBar.value = pct;
                progressFill.style.width = pct + '%';
                currentTimeEl.innerText = formatTime(audio.currentTime);
            }
        });

        audio.addEventListener('ended', () => {
            nextSong();
        });

        // Xử lý lỗi khi link nhạc chết
        audio.addEventListener('error', (e) => {
            console.log("Audio Error:", e);
            // Tự động next bài nếu lỗi
            if(isPlaying) setTimeout(nextSong, 1000);
        });

        // --- 5. ĐIỀU KHIỂN ---

        function nextSong() {
            let nextIndex = currentIndex + 1;
            if (nextIndex >= playlist.length) nextIndex = 0;
            loadAndPlaySong(nextIndex);
        }

        function prevSong() {
            let prevIndex = currentIndex - 1;
            if (prevIndex < 0) prevIndex = playlist.length - 1;
            loadAndPlaySong(prevIndex);
        }

        // Click bài hát trong list
        window.playSongByIndex = function(index) {
            loadAndPlaySong(index);
        };

        // --- 6. UI HELPERS ---

        function renderSongList() {
            const container = document.getElementById('song-list');
            if(!container) return;
            container.innerHTML = '';
            
            if (playlist.length === 0) {
                container.innerHTML = '<p class="text-zinc-500 p-4 col-span-3 text-center">Trống.</p>';
                return;
            }

            playlist.forEach((song, index) => {
                const isActive = index === currentIndex;
                // Nếu bài đang phát, icon là cột sóng nhạc (nếu có) hoặc pause/play
                const html = `
                    <div onclick="playSongByIndex(${index})" class="flex items-center gap-3 p-3 rounded-lg cursor-pointer transition group ${isActive ? 'bg-white/10' : 'hover:bg-zinc-800/50'}">
                        <div class="relative w-12 h-12 flex-shrink-0">
                            <img src="${song.cover}" class="w-full h-full object-cover rounded shadow-sm">
                            ${isActive ? `
                                <div class="absolute inset-0 bg-black/50 flex items-center justify-center rounded">
                                    <div class="w-2 h-2 bg-emerald-400 rounded-full animate-ping"></div>
                                </div>
                            ` : ''}
                        </div>
                        <div class="flex-1 min-w-0">
                            <h4 class="font-semibold text-sm truncate ${isActive ? 'text-emerald-400' : 'text-white'}">${song.title}</h4>
                            <p class="text-xs text-zinc-400 truncate">${song.artist}</p>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        function showEmptyState() {
            document.getElementById('hero-title').innerText = "Chưa có nhạc";
            document.getElementById('hero-artist').innerText = "Thêm nhạc trong Admin";
        }

        function formatTime(seconds) {
            if (isNaN(seconds)) return "0:00";
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return `${min}:${sec < 10 ? '0' + sec : sec}`;
        }

        // --- 7. INPUT EVENTS (SEEKING & VOLUME) ---

        // Tua nhạc (Xử lý kỹ cho mobile touch)
        progressBar.addEventListener('input', (e) => {
            isSeeking = true;
            const pct = e.target.value;
            progressFill.style.width = pct + '%';
            if(audio.duration) {
                const time = (pct / 100) * audio.duration;
                currentTimeEl.innerText = formatTime(time);
            }
        });

        progressBar.addEventListener('change', (e) => {
            isSeeking = false;
            if (audio.duration) {
                audio.currentTime = (e.target.value / 100) * audio.duration;
            }
        });

        // Volume
        volumeBar.addEventListener('input', (e) => {
            audio.volume = e.target.value;
            volumeFill.style.width = (e.target.value * 100) + '%';
        });

        // --- 8. ADMIN LOGIC (GIỮ NGUYÊN NHƯNG TỐI ƯU UI) ---
        
        window.openAdminModal = function() {
            document.getElementById('admin-modal').classList.remove('hidden');
            renderAdminSongList();
        }
        window.closeAdminModal = function() {
            document.getElementById('admin-modal').classList.add('hidden');
        }

        window.renderAdminSongList = function() {
            const list = document.getElementById('admin-song-list');
            list.innerHTML = '';
            
            allSongs.forEach((song, index) => {
                const html = `
                    <tr class="hover:bg-zinc-800/30">
                        <td class="px-4 py-3">
                            <div class="font-medium text-white truncate max-w-[180px]">${song.title}</div>
                        </td>
                        <td class="px-2 py-3 text-center">
                            <input type="checkbox" 
                                class="w-4 h-4 accent-emerald-500 rounded" 
                                ${!song.isHidden ? 'checked' : ''} 
                                onchange="toggleSongVisibility(${index})"
                            >
                        </td>
                        <td class="px-2 py-3 text-center">
                            <button onclick="deleteSong(${index})" class="text-zinc-500 hover:text-red-500 p-1"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </td>
                    </tr>
                `;
                list.insertAdjacentHTML('beforeend', html);
            });
            if(window.lucide) lucide.createIcons();
        }

        window.addNewSong = function() {
            const title = document.getElementById('input-title').value;
            const url = document.getElementById('input-url').value;
            if(!title || !url) return alert("Thiếu Tên hoặc Link!");

            allSongs.push({
                id: Date.now(),
                title,
                artist: document.getElementById('input-artist').value || "Unknown",
                cover: document.getElementById('input-cover').value || "https://via.placeholder.com/300",
                url,
                isHidden: false
            });
            saveData();
            updatePlaylist();
            renderAdminSongList();
            alert("Đã thêm!");
            
            document.getElementById('input-title').value = "";
            document.getElementById('input-url').value = "";
        };

        window.toggleSongVisibility = function(i) {
            allSongs[i].isHidden = !allSongs[i].isHidden;
            saveData();
            updatePlaylist();
        };

        window.deleteSong = function(i) {
            if(confirm("Xóa?")) {
                allSongs.splice(i, 1);
                saveData();
                updatePlaylist();
                renderAdminSongList();
            }
        };

        window.resetDefaultSongs = function() {
            if(confirm("Khôi phục danh sách gốc?")) {
                allSongs = [...defaultSongs];
                saveData();
                updatePlaylist();
                renderAdminSongList();
            }
        };

        // Sidebar Mobile
        const sidebar = document.getElementById('sidebar');
        document.getElementById('open-sidebar').onclick = () => sidebar.classList.remove('-translate-x-full');
        document.getElementById('close-sidebar').onclick = () => sidebar.classList.add('-translate-x-full');

        // Binding buttons
        playPauseBtn.onclick = togglePlay;
        heroPlayBtn.onclick = togglePlay;
        document.getElementById('next-btn').onclick = nextSong;
        document.getElementById('prev-btn').onclick = prevSong;

        // Start
        window.onload = init;

    </script>
</body>
</html>
